(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const s=t=>`$${Number(t).toFixed(2)}`,c={getProducts:async()=>await(await fetch("/api/products")).json(),getProduct:async t=>{const e=await fetch(`/api/products/${t}`);return e.ok?e.json():null},getCart:async()=>(await fetch("/api/cart")).json(),addToCart:async(t,e)=>(await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:t,quantity:e})})).json(),updateCartItem:async(t,e)=>(await fetch(`/api/cart/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:e})})).json(),removeFromCart:async t=>(await fetch(`/api/cart/${t}`,{method:"DELETE"})).json(),createOrder:async t=>{const e=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("Order failed");return e.json()},adminLogin:async t=>{const e=await fetch("/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("Failed");return e.json()},checkAdmin:async()=>(await fetch("/api/admin/check")).json(),addProduct:async t=>{await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})},deleteProduct:async t=>{await fetch(`/api/products/${t}`,{method:"DELETE"})},getOrders:async()=>(await fetch("/api/orders")).json(),logout:async()=>{await fetch("/api/admin/logout",{method:"POST"}),window.location.reload()}};function C(t){const e=document.getElementById("cart-count");e&&(e.textContent=t)}async function m(){const e=(await c.getCart()).reduce((n,i)=>n+i.quantity,0);C(e)}function u(t){document.querySelectorAll(".view-section").forEach(n=>n.classList.remove("active"));const e=document.getElementById(t);e&&e.classList.add("active"),window.scrollTo(0,0)}function g(t,e){e.innerHTML=t.map(n=>`
    <div class="product-card" onclick="window.location.href='/product.html?id=${n.id}'">
      <div class="product-image-container">
        <img src="${n.image}" alt="${n.name}" class="product-image" loading="lazy">
      </div>
      <div class="product-info">
        <span class="product-name">${n.name}</span>
        <span class="product-price">${s(n.price)}</span>
      </div>
    </div>
  `).join("")}async function y(){u("view-home");const e=(await c.getProducts()).slice(0,2),n=document.getElementById("featured-grid");n&&g(e,n)}async function P(){u("view-products");const t=await c.getProducts(),e=document.getElementById("products-grid"),n=document.getElementById("category-filter"),i=r=>g(r,e);i(t),n.onchange=r=>{const o=r.target.value,a=o==="ALL"?t:t.filter(d=>d.category===o);i(a)}}async function T(){u("view-product-detail");const e=new URLSearchParams(window.location.search).get("id");if(!e)return;const n=await c.getProduct(e);if(!n)return;const i=document.getElementById("product-image"),r=document.getElementById("product-name"),o=document.getElementById("product-price"),a=document.getElementById("product-description");i&&(i.src=n.image),r&&(r.textContent=n.name),o&&(o.textContent=s(n.price)),a&&(a.textContent=n.description);const d=document.getElementById("add-to-cart"),l=document.getElementById("qty"),v=document.getElementById("qty-minus"),I=document.getElementById("qty-plus"),f=d.cloneNode(!0);d.parentNode.replaceChild(f,d),v.onclick=()=>{l.value>1&&l.value--},I.onclick=()=>{l.value++},f.onclick=async function(){this.disabled=!0,this.textContent="ACQUIRED",await c.addToCart(n.id,parseInt(l.value)),await m(),setTimeout(()=>{this.disabled=!1,this.textContent="ACQUIRE OBJECT"},1500)}}async function h(){u("view-cart");const t=await c.getCart(),e=await c.getProducts(),n=document.getElementById("cart-items"),i=document.getElementById("cart-total");if(t.length===0){n.innerHTML='<p style="font-size:1.5rem; color:#444;">BAG IS EMPTY</p>',i.textContent="$0.00";return}let r=0;n.innerHTML=t.map(o=>{const a=e.find(l=>l.id===o.productId);if(!a)return"";const d=a.price*o.quantity;return r+=d,`
      <div class="cart-item">
        <img src="${a.image}" class="cart-item-img">
        <div>
          <h3 style="font-size:1.5rem; font-weight:700;">${a.name}</h3>
          <p style="color:#666;">UNITS: ${o.quantity}</p>
          <button onclick="removeItem('${a.id}')" style="background:none; border:none; color:var(--accent); text-transform:uppercase; cursor:pointer; margin-top:10px;">Remove</button>
        </div>
        <div style="font-size:1.5rem;">${s(d)}</div>
      </div>
    `}).join(""),i.textContent=s(r),window.removeItem=async o=>{await c.removeFromCart(o),h(),m()}}async function B(){u("view-checkout");const t=document.getElementById("checkout-form"),e=await c.getCart(),n=await c.getProducts(),i=e.reduce((r,o)=>{const a=n.find(d=>d.id===o.productId);return r+(a?a.price*o.quantity:0)},0);document.getElementById("order-total-summary").textContent=s(i),t.onsubmit=async r=>{r.preventDefault();const o=new FormData(t);await c.createOrder({customerName:o.get("name"),email:o.get("email"),address:o.get("address"),items:e,total:i}),alert("ACQUISITION COMPLETE"),window.location.href="/"}}async function w(){const{isAdmin:t}=await c.checkAdmin();if(!t){u("view-admin-login");return}u("view-admin-dashboard"),p()}async function p(){const t=await c.getProducts(),e=await c.getOrders();document.getElementById("admin-products").innerHTML=t.map(n=>`
    <tr>
      <td>${n.name}</td>
      <td>${s(n.price)}</td>
      <td>${n.stock}</td>
      <td><button onclick="deleteProd('${n.id}')" style="background:var(--accent); color:#fff; border:none; padding:5px 10px;">DELETE</button></td>
    </tr>
  `).join(""),document.getElementById("admin-orders").innerHTML=e.map(n=>`
    <tr>
      <td>${n.id.slice(0,8)}</td>
      <td>${n.customerName}</td>
      <td>${s(n.total)}</td>
      <td>${new Date(n.createdAt).toLocaleDateString()}</td>
    </tr>
  `).join("")}window.deleteProd=async t=>{confirm("ERASE?")&&(await c.deleteProduct(t),p())};document.getElementById("login-form").onsubmit=async t=>{t.preventDefault();const e=new FormData(t.target);try{await c.adminLogin(Object.fromEntries(e)),w()}catch{alert("INVALID KEY")}};document.getElementById("add-product-form").onsubmit=async t=>{t.preventDefault();const e=new FormData(t.target),n=Object.fromEntries(e);n.price=parseFloat(n.price),n.stock=10,await c.addProduct(n),t.target.reset(),p()};document.getElementById("logout-btn").onclick=c.logout;function E(){const t=window.location.pathname;m(),t==="/"||t==="/index.html"?y():t==="/products.html"?P():t==="/product.html"?T():t==="/cart.html"?h():t==="/checkout.html"?B():t==="/admin.html"?w():y()}E();window.onpopstate=E;
